<!doctype html><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=author content=ylxdzsw@gmail.com><meta charset=utf-8><title>Simple Push</title><style></style><button id=subscribe>Subscribe</button><div id=info></div><script>async function gen_key(){const e=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]),r=await crypto.subtle.exportKey("jwk",e.privateKey);return delete r.alg,delete r.ext,delete r.key_ops,r}async function import_key(e){return await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!0,["sign"])}async function sign_token(e,r){await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},r,(new TextEncoder).encode(e))}function array_buffer_to_base64_url(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function base64_url_to_array_buffer(e){return Uint8Array.from(atob(e.replace(/-/g,"+").replace(/_/g,"/")),(e=>e.charCodeAt(0))).buffer}function make_jwt(e,r){Math.floor(Date.now()/1e3+43200)}function public_key_to_buffer(e){const r=new Uint8Array(65);return r[0]=4,r.set(base64_url_to_array_buffer(e.x),1),r.set(base64_url_to_array_buffer(e.y),33),r.buffer}async function subscribe(e,r){return await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})}(async()=>{document.getElementById("subscribe").addEventListener("click",(async()=>{if("granted"!==await Notification.requestPermission())throw new Error("Permission not granted for Notification");const e=subscribe(await navigator.serviceWorker.register("worker.js"),public_key_to_buffer({x:"iBQjad25VAeYizxjuoaBT-xFp1Isr-RqZ7WXsO-IlVw",y:"O7HOr2bL3okliqN1fsjeIZcwIKVvsGFLzbFtJ8Vl7kM"}));document.getElementById("info").innerText=JSON.stringify(e)}))})()</script>